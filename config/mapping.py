"""
店舗名とカテゴリ・勘定科目のマッピング設定
"""
from typing import Dict, List, Tuple

# 店舗名キーワードとカテゴリ・勘定科目のマッピング
STORE_CATEGORY_MAPPING: Dict[str, Tuple[str, str]] = {
    # 食費関連
    'マクドナルド': ('食費', '販管費'),
    'スターバックス': ('食費', '販管費'),
    'セブンイレブン': ('食費', '販管費'),
    'ローソン': ('食費', '販管費'),
    'ファミリーマート': ('食費', '販管費'),
    'スーパー': ('食費', '販管費'),
    'コンビニ': ('食費', '販管費'),
    'レストラン': ('食費', '販管費'),
    'カフェ': ('食費', '販管費'),
    '居酒屋': ('食費', '販管費'),
    'ラーメン': ('食費', '販管費'),
    '寿司': ('食費', '販管費'),
    '焼肉': ('食費', '販管費'),
    'うどん': ('食費', '販管費'),
    'そば': ('食費', '販管費'),
    'ピザ': ('食費', '販管費'),
    'ハンバーガー': ('食費', '販管費'),
    'ケーキ': ('食費', '販管費'),
    'パン': ('食費', '販管費'),
    
    # 交通費関連
    'JR': ('交通費', '旅費交通費'),
    '地下鉄': ('交通費', '旅費交通費'),
    'バス': ('交通費', '旅費交通費'),
    'タクシー': ('交通費', '旅費交通費'),
    '電車': ('交通費', '旅費交通費'),
    '新幹線': ('交通費', '旅費交通費'),
    '飛行機': ('交通費', '旅費交通費'),
    '高速道路': ('交通費', '旅費交通費'),
    '駐車場': ('交通費', '旅費交通費'),
    'ガソリンスタンド': ('交通費', '車両費'),
    'apollo': ('交通費', '車両費'),
    'apollostation': ('交通費', '車両費'),
    'エネオス': ('交通費', '車両費'),
    'esso': ('交通費', '車両費'),
    'エッソ': ('交通費', '車両費'),
    'shell': ('交通費', '車両費'),
    'シェル': ('交通費', '車両費'),
    'cosmo': ('交通費', '車両費'),
    'コスモ': ('交通費', '車両費'),
    '石油': ('交通費', '車両費'),
    
    # 光熱費関連
    '東京電力': ('光熱費', '水道光熱費'),
    '東京ガス': ('光熱費', '水道光熱費'),
    '水道局': ('光熱費', '水道光熱費'),
    '電力': ('光熱費', '水道光熱費'),
    'ガス': ('光熱費', '水道光熱費'),
    '水道': ('光熱費', '水道光熱費'),
    
    # 通信費関連
    'NTT': ('通信費', '通信費'),
    'ソフトバンク': ('通信費', '通信費'),
    'ドコモ': ('通信費', '通信費'),
    'au': ('通信費', '通信費'),
    'インターネット': ('通信費', '通信費'),
    'Wi-Fi': ('通信費', '通信費'),
    'プロバイダー': ('通信費', '通信費'),
    
    # 医療費関連
    '病院': ('医療費', '販管費'),
    'クリニック': ('医療費', '販管費'),
    '薬局': ('医療費', '販管費'),
    'ドラッグストア': ('医療費', '販管費'),
    '歯科': ('医療費', '販管費'),
    '眼科': ('医療費', '販管費'),
    
    # 教育費関連
    '学校': ('教育費', '研修費'),
    '大学': ('教育費', '研修費'),
    '塾': ('教育費', '研修費'),
    '予備校': ('教育費', '研修費'),
    '英会話': ('教育費', '研修費'),
    '資格': ('教育費', '研修費'),
    
    # 娯楽費関連
    '映画館': ('娯楽費', '販管費'),
    'ゲーム': ('娯楽費', '販管費'),
    '本屋': ('娯楽費', '販管費'),
    'CD': ('娯楽費', '販管費'),
    'DVD': ('娯楽費', '販管費'),
    '遊園地': ('娯楽費', '販管費'),
    '水族館': ('娯楽費', '販管費'),
    '美術館': ('娯楽費', '販管費'),
    '博物館': ('娯楽費', '販管費'),
    'コンサート': ('娯楽費', '販管費'),
    'ライブ': ('娯楽費', '販管費'),
    'カラオケ': ('娯楽費', '販管費'),
    'ボーリング': ('娯楽費', '販管費'),
    'ゴルフ': ('娯楽費', '販管費'),
    
    # 雑費関連
    '100円ショップ': ('雑費', '消耗品費'),
    'ダイソー': ('雑費', '消耗品費'),
    'セリア': ('雑費', '消耗品費'),
    'キャンドゥ': ('雑費', '消耗品費'),
    '雑貨': ('雑費', '消耗品費'),
    '文具': ('雑費', '事務用品費'),
    'オフィス': ('雑費', '事務用品費'),
    '事務用品': ('雑費', '事務用品費'),
    'dcm': ('雑費', '消耗品費'),
    'ホームセンター': ('雑費', '消耗品費'),
    'カインズ': ('雑費', '消耗品費'),
    'コメリ': ('雑費', '消耗品費'),
    'ビバホーム': ('雑費', '消耗品費'),
}

def get_category_and_account(store_name: str) -> Tuple[str, str]:
    """
    店舗名からカテゴリと勘定科目を判定する（改善版）
    
    Args:
        store_name: 店舗名
        
    Returns:
        Tuple[str, str]: (カテゴリ, 勘定科目)
    """
    if not store_name:
        return '雑費', 'その他販管費'
    
    store_name_lower = store_name.lower()
    
    # より詳細なマッピング
    for keyword, (category, account) in STORE_CATEGORY_MAPPING.items():
        if keyword.lower() in store_name_lower:
            return category, account
    
    # 追加の判定ロジック
    if any(word in store_name_lower for word in ['dcm', 'ホームセンター', 'カインズ', 'コメリ', 'ビバホーム']):
        return '雑費', '消耗品費'
    elif any(word in store_name_lower for word in ['apollo', 'エネオス', 'esso', 'shell', 'cosmo', '石油']):
        return '交通費', '車両費'
    elif any(word in store_name_lower for word in ['東京ガス', '東京電力', '水道局', '電力', 'ガス', '水道']):
        return '光熱費', '水道光熱費'
    elif any(word in store_name_lower for word in ['セブン', 'ローソン', 'ファミマ', 'コンビニ', 'スーパー']):
        return '食費', '販管費'
    elif any(word in store_name_lower for word in ['病院', 'クリニック', '薬局', 'ドラッグ']):
        return '医療費', '販管費'
    
    # デフォルトは雑費
    return '雑費', 'その他販管費'

def get_payment_method_from_text(text: str) -> str:
    """
    OCRテキストから支払方法を判定する
    
    Args:
        text: OCRで抽出されたテキスト
        
    Returns:
        str: 支払方法
    """
    text_lower = text.lower()
    
    if any(keyword in text_lower for keyword in ['現金', 'cash']):
        return '現金'
    elif any(keyword in text_lower for keyword in ['クレジット', 'credit', 'visa', 'mastercard', 'jcb']):
        return 'クレジットカード'
    elif any(keyword in text_lower for keyword in ['電子マネー', 'suica', 'pasmo', 'edy', 'nanaco']):
        return '電子マネー'
    else:
        return 'その他'

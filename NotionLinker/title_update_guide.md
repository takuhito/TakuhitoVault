# Notion 日記タイトル一括変更ツール

## 概要
Notionの日記データベース内のページタイトルを一括で「2025-08-16」形式から「2025-0816」形式に変更するツールです。

## セットアップ

### 1. .envファイルの作成
プロジェクトルートに`.env`ファイルを作成し、以下の内容を設定してください：

```bash
# Notion API 設定
NOTION_TOKEN=your_notion_integration_token_here
JOURNAL_DB_ID=your_journal_database_id_here

# 実行モード（true=テスト実行、false=実際の変更）
DRY_RUN=true

# API タイムアウト設定（秒）
NOTION_TIMEOUT=60
```

### 2. 必要な値の取得

#### NOTION_TOKEN
1. [Notion Integrations](https://www.notion.so/my-integrations) にアクセス
2. 新しいインテグレーションを作成
3. Internal Integration を選択
4. 作成されたトークンをコピー

#### JOURNAL_DB_ID
1. Notionで日記データベースを開く
2. URLからデータベースIDを取得
   - URL例: `https://www.notion.so/workspace/1234567890abcdef1234567890abcdef?v=...`
   - データベースID: `1234567890abcdef1234567890abcdef`

### 3. インテグレーションの権限設定
1. 日記データベースのページで「...」メニューを開く
2. 「Add connections」を選択
3. 作成したインテグレーションを追加

## 使用方法

### 1. テスト実行（推奨）
まず、実際の変更を行わずに結果を確認します：

```bash
python update_journal_titles.py
```

この実行では：
- 変更対象のページが表示されます
- 実際の変更は行われません
- 変更内容を事前に確認できます

### 2. 実際の変更実行
テスト実行で問題がないことを確認後、実際の変更を行います：

1. `.env`ファイルで`DRY_RUN=false`に設定
2. スクリプトを実行：
```bash
python update_journal_titles.py
```
3. 確認メッセージが表示されたら`y`を入力

## 機能

### タイトル変換ルール
- **変換前**: `2025-08-16`
- **変換後**: `2025-0816`
- パターンに一致しないタイトルは変更されません

### 安全機能
- **DRY_RUN モード**: デフォルトで有効、実際の変更を行わずに結果を確認
- **確認プロンプト**: 実際の変更前にユーザーの確認を求める
- **リトライ機能**: API制限やタイムアウト時に自動リトライ
- **レート制限対策**: リクエスト間に0.2秒の間隔を設定

## トラブルシューティング

### よくあるエラー

#### 「環境変数が未設定です」
- `.env`ファイルが正しく作成されているか確認
- `NOTION_TOKEN`と`JOURNAL_DB_ID`が設定されているか確認

#### 「プロパティが見つかりません」
- データベースのタイトルプロパティ名が「タイトル」になっているか確認
- 必要に応じて`update_journal_titles.py`内のプロパティ名を修正

#### API制限エラー
- スクリプトが自動的にリトライします
- 大量のページがある場合は、時間を置いて再実行してください

## 注意事項

⚠️ **重要な注意**
- 変更前のデータのバックアップを推奨します
- 最初は必ず`DRY_RUN=true`でテスト実行してください
- 変更は元に戻せません（Notionの履歴機能で確認可能）

## カスタマイズ

### タイトル変換ルールの変更
`convert_title_format`関数を修正することで、異なる変換ルールを適用できます。

### プロパティ名の変更
データベースのタイトルプロパティ名が「タイトル」以外の場合は、`get_page_title`関数と`update_page_title`関数内のプロパティ名を修正してください。
